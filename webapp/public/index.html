<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blissify Webapp</title>
</head>
<body>
    <h1>Blissify Webapp</h1>
    
    <form id="network-path-form">
        <label for="network-path">Entrez le chemin du dossier réseau :</label>
        <input type="text" id="network-path" name="network-path" placeholder="smb://192.168.1.xxx/Musique" required>
        <button type="submit">Monter et Lancer</button>
    </form>

    <button id="start-analysis" style="display:none;">Démarrer l'Analyse</button>
    <div id="result"></div>

    <!-- Bouton pour chercher l'instance Volumio -->
    <button onclick="searchVolumio()">Chercher Volumio</button>
    <pre id="volumio-output"></pre>

    <!-- Bouton pour uploader song.db -->
    <button onclick="uploadSongDb()">Uploader song.db</button>
    <pre id="upload-output"></pre>

   <script> 
        
        function searchMusic() {
            fetch('/search-music')
                .then(response => response.text())
                .then(data => document.getElementById('music-output').innerText = data);
        } 

        function startAnalysis() {
            fetch('/start-analysis')
                .then(response => response.text())
                .then(data => document.getElementById('analysis-output').innerText = data);
        }

        function searchVolumio() {
            fetch('/search-volumio')
                .then(response => response.text())
                .then(data => document.getElementById('volumio-output').innerText = data);
        }

        function uploadSongDb() {
            fetch('/upload-songdb', { method: 'POST' })
                .then(response => response.text())
                .then(data => document.getElementById('upload-output').innerText = data);
        }

        document.getElementById('network-path-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const networkPath = document.getElementById('network-path').value;

            // Monter le partage NAS
            fetch(`/mount-nas?path=${encodeURIComponent(networkPath)}`)
                .then(response => response.text())
                .then(data => {
                    document.getElementById('result').innerText = data;

                    // Lancer blissify init après le montage
                    fetch(`/run-blissify`)
                        .then(response => response.text())
                        .then(data => {
                            document.getElementById('result').innerText += `\n\n${data}`;
                        })
                        .catch(error => {
                            document.getElementById('result').innerText += `\nErreur lors de l'exécution de blissify : ${error}`;
                        });
                })
                .catch(error => {
                    document.getElementById('result').innerText = `Erreur lors du montage : ${error}`;
                });
        });

    </script>
</body>
</html>
